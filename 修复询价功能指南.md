# ğŸ”§ ä¿®å¤è¯¢ä»·æäº¤åŠŸèƒ½ - ç»ˆæè§£å†³æ–¹æ¡ˆ

## âŒ å½“å‰é—®é¢˜
é”™è¯¯ä¿¡æ¯ï¼š`Error: new row violates row-level security policy for table "enquiries"`

**åŸå› **ï¼šSupabaseæ•°æ®åº“çš„Row Level Security (RLS)ç­–ç•¥é˜»æ­¢äº†åŒ¿åç”¨æˆ·æ’å…¥æ•°æ®åˆ°enquiriesè¡¨ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ğŸ“ æ­¥éª¤ 1: ç™»å½• Supabase Dashboard

1. è®¿é—®ï¼šhttps://supabase.com/dashboard
2. é€‰æ‹©é¡¹ç›®ï¼š**zoxiyuaf2kymgxmsluifsql**
3. ç‚¹å‡»å·¦ä¾§èœå•ï¼š**SQL Editor**

---

### ğŸ“ æ­¥éª¤ 2: æ‰§è¡Œä¿®å¤è„šæœ¬

1. ç‚¹å‡» **"New query"** æŒ‰é’®
2. æ‰“å¼€æ–‡ä»¶ï¼š`supabase_enquiries_absolute_fix.sql`
3. **å¤åˆ¶å…¨éƒ¨å†…å®¹**
4. **ç²˜è´´åˆ° SQL Editor**
5. ç‚¹å‡» **"Run"** æŒ‰é’®ï¼ˆæˆ–æŒ‰ `Ctrl+Enter` / `Cmd+Enter`ï¼‰

---

### ğŸ“ æ­¥éª¤ 3: éªŒè¯æ‰§è¡Œç»“æœ

æ‰§è¡ŒæˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ° **5 ä¸ªæŸ¥è¯¢ç»“æœ**ï¼š

#### âœ… ç»“æœ 1: å·²åˆ é™¤çš„ç­–ç•¥åˆ—è¡¨
åº”è¯¥æ˜¾ç¤º **0 rows**ï¼ˆè¡¨ç¤ºæ—§ç­–ç•¥å·²å…¨éƒ¨æ¸…é™¤ï¼‰

#### âœ… ç»“æœ 2: RLS çŠ¶æ€
```
schemaname | tablename | rls_enabled
-----------|-----------|------------
public     | enquiries | true
```

#### âœ… ç»“æœ 3: å½“å‰ç­–ç•¥åˆ—è¡¨
åº”è¯¥æ˜¾ç¤º **2 æ¡ç­–ç•¥**ï¼š
```
policyname              | roles          | cmd    | with_check
------------------------|----------------|--------|------------
Allow all inserts       | {public}       | INSERT | true
Allow authenticated selects | {authenticated} | SELECT | true
```

#### âœ… ç»“æœ 4: è§’è‰²æƒé™æ£€æŸ¥
```
role_name      | can_insert | can_select
---------------|------------|------------
anon           | true       | false
authenticated  | true       | true
public         | true       | false
```

#### âœ… ç»“æœ 5: æˆåŠŸæ¶ˆæ¯
```
status
------
âœ… RLS ABSOLUTE FIX COMPLETE! All policies reset and reconfigured.
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
åœ¨æµè§ˆå™¨ä¸­æŒ‰ `Ctrl+Shift+R` (Windows) æˆ– `Cmd+Shift+R` (Mac) å¼ºåˆ¶åˆ·æ–°é¡µé¢

### 2. æµ‹è¯•è¯¢ä»·åŠŸèƒ½
1. è®¿é—®ï¼šhttps://web-project-naxiwell.vercel.app
2. é€‰æ‹©ä»»æ„äº§å“ï¼Œç‚¹å‡»äº§å“å¡ç‰‡
3. ç‚¹å‡» **"Add to Cart"**
4. ç‚¹å‡»å³ä¸Šè§’è´­ç‰©è½¦å›¾æ ‡
5. ç‚¹å‡» **"Proceed to Enquiry"**
6. å¡«å†™è¡¨å•ï¼š
   - Name: Test User
   - Email: test@example.com
   - Phone: 0412345678
7. ç‚¹å‡» **"Submit Enquiry"**

### 3. é¢„æœŸç»“æœ
- âœ… ä¸å†æ˜¾ç¤ºé”™è¯¯å¼¹çª—
- âœ… æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼š`Thank you for your enquiry, Test User!...`
- âœ… è´­ç‰©è½¦æ¸…ç©º
- âœ… è¡¨å•å…³é—­

---

## ğŸ” å¦‚æœä»ç„¶å¤±è´¥

### æ£€æŸ¥ 1: ç¡®è®¤ Supabase è¿æ¥
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œæ£€æŸ¥ Console æ˜¯å¦æœ‰å…¶ä»–é”™è¯¯

### æ£€æŸ¥ 2: ç¡®è®¤ Anon Key æ­£ç¡®
åœ¨ `config.js` ä¸­ç¡®è®¤ `supabase.anonKey` æ˜¯æ­£ç¡®çš„

### æ£€æŸ¥ 3: æ£€æŸ¥æ•°æ®åº“ä¸­çš„æ•°æ®
åœ¨ Supabase Dashboard â†’ Table Editor â†’ enquiries è¡¨ä¸­ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ–°è®°å½•æ’å…¥

---

## ğŸ“Š æŠ€æœ¯è¯´æ˜

### ä¸ºä»€ä¹ˆä¹‹å‰çš„ä¿®å¤æ— æ•ˆï¼Ÿ

1. **ç­–ç•¥ç›®æ ‡é”™è¯¯**ï¼šä¹‹å‰çš„è„šæœ¬åªé’ˆå¯¹ `anon` è§’è‰²ï¼Œä½†å¯èƒ½é¡¹ç›®é…ç½®ä½¿ç”¨çš„æ˜¯ `public` è§’è‰²
2. **ç­–ç•¥æœªæ¸…ç†**ï¼šæ—§ç­–ç•¥å¯èƒ½ä¸æ–°ç­–ç•¥å†²çª
3. **ç¼“å­˜é—®é¢˜**ï¼šSupabase å¯èƒ½ç¼“å­˜äº†æ—§çš„ç­–ç•¥é…ç½®

### è¿™ä¸ªä¿®å¤åšäº†ä»€ä¹ˆï¼Ÿ

1. âœ… **å®Œå…¨ç¦ç”¨ RLS** â†’ æ¸…é™¤æ‰€æœ‰ç¼“å­˜
2. âœ… **åˆ é™¤æ‰€æœ‰æ—§ç­–ç•¥** â†’ ä½¿ç”¨åŠ¨æ€ SQL ç¡®ä¿æ¸…ç†å½»åº•
3. âœ… **é‡æ–°å¯ç”¨ RLS** â†’ ä»å¹²å‡€çŠ¶æ€å¼€å§‹
4. âœ… **åˆ›å»ºç®€å•ç­–ç•¥** â†’ é’ˆå¯¹ `public` è§’è‰²ï¼ˆè¦†ç›–æ‰€æœ‰åŒ¿åç”¨æˆ·ï¼‰
5. âœ… **éªŒè¯æƒé™** â†’ ç¡®è®¤ `anon` å’Œ `public` éƒ½æœ‰ INSERT æƒé™

### æ–°ç­–ç•¥çš„æƒé™è®¾ç½®

```sql
-- ä»»ä½•äººéƒ½å¯ä»¥æ’å…¥ï¼ˆæäº¤è¯¢ä»·ï¼‰
CREATE POLICY "Allow all inserts"
ON enquiries FOR INSERT TO public
WITH CHECK (true);

-- åªæœ‰å·²è®¤è¯ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ï¼ˆç®¡ç†å‘˜æŸ¥çœ‹ï¼‰
CREATE POLICY "Allow authenticated selects"
ON enquiries FOR SELECT TO authenticated
USING (true);
```

---

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä½¿ç”¨ `public` è€Œä¸æ˜¯ `anon`ï¼Ÿ
A: `public` è§’è‰²æ˜¯æ‰€æœ‰è§’è‰²çš„çˆ¶çº§ï¼ŒåŒ…æ‹¬ `anon` å’Œ `authenticated`ã€‚ä½¿ç”¨ `public` å¯ä»¥ç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æƒé™ã€‚

### Q: è¿™æ ·å®‰å…¨å—ï¼Ÿ
A: æ˜¯çš„ï¼Œå› ä¸ºï¼š
- åªå…è®¸ INSERTï¼ˆæ’å…¥ï¼‰ï¼Œä¸å…è®¸ UPDATE/DELETE
- åªå…è®¸æ’å…¥æ•°æ®ï¼Œä¸å…è®¸è¯»å–ä»–äººçš„æ•°æ®
- å·²è®¤è¯ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰æ‰èƒ½æŸ¥çœ‹æ‰€æœ‰è¯¢ä»·

### Q: å¦‚æœè¿˜æ˜¯ä¸è¡Œæ€ä¹ˆåŠï¼Ÿ
A: è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. SQL æ‰§è¡Œç»“æœçš„æˆªå›¾
2. æµè§ˆå™¨ Console çš„å®Œæ•´é”™è¯¯ä¿¡æ¯
3. Supabase Dashboard â†’ Table Editor â†’ enquiries çš„æˆªå›¾

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæ‰§è¡Œåä»ç„¶å¤±è´¥ï¼Œè¯·ï¼š
1. æˆªå›¾ SQL Editor çš„æ‰€æœ‰æ‰§è¡Œç»“æœ
2. æˆªå›¾æµè§ˆå™¨ Console çš„é”™è¯¯ï¼ˆæŒ‰ F12 â†’ Console æ ‡ç­¾ï¼‰
3. å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯æç¤ºæ–‡å­—
